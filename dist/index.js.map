{"version":3,"sources":["../src/useResponsiveGSAP.ts"],"sourcesContent":["// useResponsiveGSAP.ts\nimport {useGSAP, useGSAPConfig, useGSAPReturn} from \"@gsap/react\";\nimport gsap from \"gsap\";\n\ngsap.registerPlugin(useGSAP);\n\ntype Setup = (root: HTMLElement) => {\n    timeline?: gsap.core.Timeline;\n    cleanup?: () => void;\n};\n\nexport interface PageLoadingHandlers {\n    isLoadComplete: () => boolean;\n    isLoadingEnabled: () => boolean;\n    onLoadComplete: (fn: () => void) => void;\n    offLoadComplete: (fn: () => void) => void;\n}\n\ninterface useResponsiveGSAPConfig extends useGSAPConfig {\n    setup?: Setup;\n    mediaQueries?: { query: string; setup: Setup; }[];\n    observeResize?: string;\n    playAfterLoad?: boolean | PageLoadingHandlers;\n    debug?: boolean;\n}\n\nexport function useResponsiveGSAP({\n                                      scope,\n                                      dependencies,\n                                      revertOnUpdate,\n                                      setup,\n                                      mediaQueries,\n                                      observeResize,\n                                      playAfterLoad = false,\n                                      debug = false,\n                                  }: useResponsiveGSAPConfig): useGSAPReturn {\n    return useGSAP(\n        () => {\n            const root = getRoot(scope);\n\n            if (!root) {\n                console.warn(\"[useResponsiveGSAP] No root element found\");\n                return;\n            }\n\n            if (debug) console.log(\"[useResponsiveGSAP] Initializing\");\n\n            // Resolve handlers if playAfterLoad is provided as an object\n            let handlers: PageLoadingHandlers | undefined;\n            if (playAfterLoad) {\n                if (typeof playAfterLoad === \"object\") {\n                    handlers = playAfterLoad as PageLoadingHandlers;\n                } else {\n                    // boolean true used without handlers -> fail fast\n                    throw new Error(\n                        \"[useResponsiveGSAP] playAfterLoad is true but no handlers provided. \" +\n                        \"Use playAfterLoad: { isLoadComplete, isLoadingEnabled, onLoadComplete, offLoadComplete }\"\n                    );\n                }\n            }\n\n            const mm = gsap.matchMedia();\n\n            // Type assertion after null check - root is guaranteed to be HTMLElement here\n            const safeRoot = root as HTMLElement;\n\n            // Track the current timeline reference across setup calls\n            let currentTimelineRef: { tl: gsap.core.Timeline | null } = {tl: null};\n            let userCleanup: (() => void) | undefined;\n\n            // Wrapper that captures timeline and handles playAfterLoad logic\n            function wrapSetup(userSetup: Setup) {\n                return () => {\n                    if (debug) console.log(\"[useResponsiveGSAP] Running setup\");\n\n                    // Clean up previous user cleanup\n                    if (userCleanup) {\n                        if (debug) console.log(\"[useResponsiveGSAP] Running user cleanup\");\n                        userCleanup();\n                    }\n\n                    // Run user's setup and capture return value\n                    const result = userSetup(safeRoot);\n\n                    // Extract timeline and cleanup from result\n                    currentTimelineRef.tl = result.timeline || null;\n                    userCleanup = result.cleanup;\n\n                    if (debug) {\n                        console.log(\"[useResponsiveGSAP] Timeline captured:\", currentTimelineRef.tl);\n                        if (handlers) {\n                            console.log(\"[useResponsiveGSAP] isLoadComplete:\", handlers.isLoadComplete());\n                        }\n                    }\n\n                    // If playAfterLoad is enabled, ensure timeline starts paused\n                    if (playAfterLoad && currentTimelineRef.tl) {\n                        // handlers exists because we threw earlier if playAfterLoad was boolean true\n                        if (handlers!.isLoadingEnabled()) {\n                            // Loading is enabled, pause and wait for load complete\n                            if (!currentTimelineRef.tl.paused()) {\n                                if (debug) console.log(\"[useResponsiveGSAP] Pausing timeline (playAfterLoad enabled)\");\n                                currentTimelineRef.tl.pause();\n                            }\n\n                            // If page is already loaded, play the timeline\n                            if (handlers!.isLoadComplete()) {\n                                if (debug) console.log(\"[useResponsiveGSAP] Playing timeline (load already complete)\");\n                                currentTimelineRef.tl.play();\n                            }\n                        } else {\n                            // If loading animation is disabled, just play immediately\n                            if (debug) console.log(\"[useResponsiveGSAP] Loading disabled, playing timeline immediately\");\n                            // Don't pause, let it play naturally\n                            currentTimelineRef.tl.play();\n                        }\n                    }\n                };\n            }\n\n            // Helper to setup load complete handler\n            const setupLoadCompleteHandler = () => {\n                if (!playAfterLoad || !handlers) return undefined;\n\n                const handleLoadingComplete = () => {\n                    if (debug) console.log(\"[useResponsiveGSAP] Load complete event fired\");\n                    if (currentTimelineRef.tl) {\n                        if (debug) console.log(\"[useResponsiveGSAP] Playing timeline on load complete\");\n                        currentTimelineRef.tl.play();\n                    }\n                };\n\n                handlers.onLoadComplete(handleLoadingComplete);\n\n                return () => {\n                    if (debug) console.log(\"[useResponsiveGSAP] Cleaning up load complete listener\");\n                    handlers!.offLoadComplete(handleLoadingComplete);\n                };\n            };\n\n            // Setup mediaQueries or single setup\n            if (mediaQueries && mediaQueries.length > 0) {\n                if (debug) console.log(\"[useResponsiveGSAP] Setting up media queries:\", mediaQueries.length);\n\n                mediaQueries.forEach(({query, setup: mqSetup}) => {\n                    mm.add(query, () => {\n                        const wrappedSetup = wrapSetup(mqSetup);\n                        wrappedSetup();\n                        return setupLoadCompleteHandler();\n                    });\n                });\n            } else if (setup) {\n                if (debug) console.log(\"[useResponsiveGSAP] Setting up with default media query\");\n\n                mm.add(\"(min-width: 0px)\", () => {\n                    const wrappedSetup = wrapSetup(setup);\n                    wrappedSetup();\n                    return setupLoadCompleteHandler();\n                });\n            }\n\n            // Setup ResizeObserver\n            let ro: ResizeObserver | null = null;\n\n            if (observeResize) {\n                if (debug) console.log(\"[useResponsiveGSAP] Setting up ResizeObserver for:\", observeResize);\n\n                const elements = safeRoot.querySelectorAll(observeResize);\n\n                if (elements.length > 0) {\n                    // Get the wrapped setup from the appropriate source\n                    const setupToRun = mediaQueries && mediaQueries.length > 0\n                        ? wrapSetup(mediaQueries[0].setup) // Use first media query's setup\n                        : setup\n                            ? wrapSetup(setup)\n                            : null;\n\n                    if (setupToRun) {\n                        ro = new ResizeObserver(() => {\n                            if (debug) console.log(\"[useResponsiveGSAP] Resize detected, re-running setup\");\n                            setupToRun();\n                        });\n\n                        elements.forEach((el) => ro!.observe(el));\n\n                        if (debug) console.log(\"[useResponsiveGSAP] Observing\", elements.length, \"elements\");\n                    }\n                } else {\n                    if (debug) console.log(\"[useResponsiveGSAP] No elements found for selector:\", observeResize);\n                }\n            }\n\n            // Cleanup\n            return () => {\n                if (debug) console.log(\"[useResponsiveGSAP] Cleaning up\");\n\n                mm.revert();\n\n                if (ro) {\n                    ro.disconnect();\n                }\n\n                if (userCleanup) {\n                    userCleanup();\n                }\n            };\n        },\n        {scope, dependencies, revertOnUpdate}\n    );\n}\n\nfunction getRoot(scope: useGSAPConfig['scope']) {\n    // resolve `scope` (which may be ReactRef | Element | string) to an HTMLElement | null\n    let root: HTMLElement | null = null;\n\n    if (!scope) {\n        console.warn(\"[useResponsiveGSAP] No scope provided\");\n        return;\n    }\n\n    if (typeof scope === \"object\" && \"current\" in scope) {\n        // React ref\n        root = (scope as any).current as HTMLElement | null;\n    } else if (typeof scope === \"string\") {\n        // selector string -> resolve in DOM (guard for SSR)\n        root = typeof document !== \"undefined\" ? (document.querySelector(scope) as HTMLElement | null) : null;\n    } else if (scope instanceof Element) {\n        // direct Element\n        root = scope as HTMLElement;\n    }\n\n    return root;\n}"],"mappings":";;;;;;;AACA,OAAQ,WAAAA,MAA4C,cACpD,OAAOC,MAAU,OAEjBA,EAAK,eAAeD,CAAO,EAsBpB,SAASE,EAAkB,CACI,MAAAC,EACA,aAAAC,EACA,eAAAC,EACA,MAAAC,EACA,aAAAC,EACA,cAAAC,EACA,cAAAC,EAAgB,GAChB,MAAAC,EAAQ,EACZ,EAA2C,CACzE,OAAOV,EACH,IAAM,CACF,IAAMW,EAAOC,EAAQT,CAAK,EAE1B,GAAI,CAACQ,EAAM,CACP,QAAQ,KAAK,2CAA2C,EACxD,MACJ,CAEID,GAAO,QAAQ,IAAI,kCAAkC,EAGzD,IAAIG,EACJ,GAAIJ,EACA,GAAI,OAAOA,GAAkB,SACzBI,EAAWJ,MAGX,OAAM,IAAI,MACN,8JAEJ,EAIR,IAAMK,EAAKb,EAAK,WAAW,EAGrBc,EAAWJ,EAGbK,EAAwD,CAAC,GAAI,IAAI,EACjEC,EAGJ,SAASC,EAAUC,EAAkB,CACjC,MAAO,IAAM,CACLT,GAAO,QAAQ,IAAI,mCAAmC,EAGtDO,IACIP,GAAO,QAAQ,IAAI,0CAA0C,EACjEO,EAAY,GAIhB,IAAMG,EAASD,EAAUJ,CAAQ,EAGjCC,EAAmB,GAAKI,EAAO,UAAY,KAC3CH,EAAcG,EAAO,QAEjBV,IACA,QAAQ,IAAI,yCAA0CM,EAAmB,EAAE,EACvEH,GACA,QAAQ,IAAI,sCAAuCA,EAAS,eAAe,CAAC,GAKhFJ,GAAiBO,EAAmB,KAEhCH,EAAU,iBAAiB,GAEtBG,EAAmB,GAAG,OAAO,IAC1BN,GAAO,QAAQ,IAAI,8DAA8D,EACrFM,EAAmB,GAAG,MAAM,GAI5BH,EAAU,eAAe,IACrBH,GAAO,QAAQ,IAAI,8DAA8D,EACrFM,EAAmB,GAAG,KAAK,KAI3BN,GAAO,QAAQ,IAAI,oEAAoE,EAE3FM,EAAmB,GAAG,KAAK,GAGvC,CACJ,CAGA,IAAMK,EAA2B,IAAM,CACnC,GAAI,CAACZ,GAAiB,CAACI,EAAU,OAEjC,IAAMS,EAAwB,IAAM,CAC5BZ,GAAO,QAAQ,IAAI,+CAA+C,EAClEM,EAAmB,KACfN,GAAO,QAAQ,IAAI,uDAAuD,EAC9EM,EAAmB,GAAG,KAAK,EAEnC,EAEA,OAAAH,EAAS,eAAeS,CAAqB,EAEtC,IAAM,CACLZ,GAAO,QAAQ,IAAI,wDAAwD,EAC/EG,EAAU,gBAAgBS,CAAqB,CACnD,CACJ,EAGIf,GAAgBA,EAAa,OAAS,GAClCG,GAAO,QAAQ,IAAI,gDAAiDH,EAAa,MAAM,EAE3FA,EAAa,QAAQ,CAAC,CAAC,MAAAgB,EAAO,MAAOC,CAAO,IAAM,CAC9CV,EAAG,IAAIS,EAAO,KACWL,EAAUM,CAAO,EACzB,EACNH,EAAyB,EACnC,CACL,CAAC,GACMf,IACHI,GAAO,QAAQ,IAAI,yDAAyD,EAEhFI,EAAG,IAAI,mBAAoB,KACFI,EAAUZ,CAAK,EACvB,EACNe,EAAyB,EACnC,GAIL,IAAII,EAA4B,KAEhC,GAAIjB,EAAe,CACXE,GAAO,QAAQ,IAAI,qDAAsDF,CAAa,EAE1F,IAAMkB,EAAWX,EAAS,iBAAiBP,CAAa,EAExD,GAAIkB,EAAS,OAAS,EAAG,CAErB,IAAMC,EAAapB,GAAgBA,EAAa,OAAS,EACnDW,EAAUX,EAAa,CAAC,EAAE,KAAK,EAC/BD,EACIY,EAAUZ,CAAK,EACf,KAENqB,IACAF,EAAK,IAAI,eAAe,IAAM,CACtBf,GAAO,QAAQ,IAAI,uDAAuD,EAC9EiB,EAAW,CACf,CAAC,EAEDD,EAAS,QAASE,GAAOH,EAAI,QAAQG,CAAE,CAAC,EAEpClB,GAAO,QAAQ,IAAI,gCAAiCgB,EAAS,OAAQ,UAAU,EAE3F,MACQhB,GAAO,QAAQ,IAAI,sDAAuDF,CAAa,CAEnG,CAGA,MAAO,IAAM,CACLE,GAAO,QAAQ,IAAI,iCAAiC,EAExDI,EAAG,OAAO,EAENW,GACAA,EAAG,WAAW,EAGdR,GACAA,EAAY,CAEpB,CACJ,EACA,CAAC,MAAAd,EAAO,aAAAC,EAAc,eAAAC,CAAc,CACxC,CACJ,CAEA,SAASO,EAAQT,EAA+B,CAE5C,IAAIQ,EAA2B,KAE/B,GAAI,CAACR,EAAO,CACR,QAAQ,KAAK,uCAAuC,EACpD,MACJ,CAEA,OAAI,OAAOA,GAAU,UAAY,YAAaA,EAE1CQ,EAAQR,EAAc,QACf,OAAOA,GAAU,SAExBQ,EAAO,OAAO,SAAa,IAAe,SAAS,cAAcR,CAAK,EAA2B,KAC1FA,aAAiB,UAExBQ,EAAOR,GAGJQ,CACX","names":["useGSAP","gsap","useResponsiveGSAP","scope","dependencies","revertOnUpdate","setup","mediaQueries","observeResize","playAfterLoad","debug","root","getRoot","handlers","mm","safeRoot","currentTimelineRef","userCleanup","wrapSetup","userSetup","result","setupLoadCompleteHandler","handleLoadingComplete","query","mqSetup","ro","elements","setupToRun","el"]}