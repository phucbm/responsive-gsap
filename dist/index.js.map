{"version":3,"sources":["../src/useGSAPResponsive.ts"],"sourcesContent":["// useGSAPResponsive.ts\nimport {useGSAP, useGSAPConfig, useGSAPReturn} from \"@gsap/react\";\nimport gsap from \"gsap\";\n\ngsap.registerPlugin(useGSAP);\n\ntype ContextSafeFunc = <T extends Function>(func: T) => T;\n\ntype Setup = (root: HTMLElement, contextSafe: ContextSafeFunc) => {\n    timeline?: gsap.core.Timeline;\n    cleanup?: () => void;\n} | void;\n\nexport interface PageLoadingHandlers {\n    isLoadComplete: () => boolean;\n    isLoadingEnabled: () => boolean;\n    onLoadComplete: (fn: () => void) => void;\n    offLoadComplete: (fn: () => void) => void;\n}\n\ninterface useGSAPResponsiveConfig extends useGSAPConfig {\n    observeResize?: string;\n    playAfterLoad?: boolean | PageLoadingHandlers;\n    debug?: boolean;\n}\n\nexport function useGSAPResponsive(\n    setupOrQueries: Setup | Array<{ query: string; setup: Setup }>,\n    config?: useGSAPResponsiveConfig\n): useGSAPReturn {\n    const {\n        scope,\n        dependencies,\n        revertOnUpdate,\n        observeResize,\n        playAfterLoad = false,\n        debug = false,\n    } = config || {};\n    return useGSAP(\n        (context, contextSafe) => {\n            const root = getRoot(scope);\n\n            if (!root) {\n                console.warn(\"[useGSAPResponsive] No root element found\");\n                return;\n            }\n\n            if (debug) console.log(\"[useGSAPResponsive] Initializing\");\n\n            // Ensure contextSafe is defined (should always be provided by useGSAP)\n            if (!contextSafe) {\n                console.error(\"[useGSAPResponsive] contextSafe not provided by useGSAP\");\n                return;\n            }\n\n            // Capture contextSafe as non-nullable for closure\n            const safeContextSafe: ContextSafeFunc = contextSafe;\n\n            // Determine if we have media queries or a single setup\n            const isMediaQueryMode = Array.isArray(setupOrQueries);\n            const mediaQueries = isMediaQueryMode ? setupOrQueries : null;\n            const singleSetup = !isMediaQueryMode ? setupOrQueries : null;\n\n            // Resolve handlers if playAfterLoad is provided as an object\n            let handlers: PageLoadingHandlers | undefined;\n            if (playAfterLoad) {\n                if (typeof playAfterLoad === \"object\") {\n                    handlers = playAfterLoad as PageLoadingHandlers;\n                } else {\n                    // boolean true used without handlers -> fail fast\n                    throw new Error(\n                        \"[useGSAPResponsive] playAfterLoad is true but no handlers provided. \" +\n                        \"Use playAfterLoad: { isLoadComplete, isLoadingEnabled, onLoadComplete, offLoadComplete }\"\n                    );\n                }\n            }\n\n            const mm = gsap.matchMedia();\n\n            // Type assertion after null check - root is guaranteed to be HTMLElement here\n            const safeRoot = root as HTMLElement;\n\n            // Track the current timeline reference across setup calls\n            let currentTimelineRef: { tl: gsap.core.Timeline | null } = {tl: null};\n            let userCleanup: (() => void) | undefined;\n\n            // Wrapper that captures timeline and handles playAfterLoad logic\n            function wrapSetup(userSetup: Setup) {\n                return () => {\n                    if (debug) console.log(\"[useGSAPResponsive] Running setup\");\n\n                    // Clean up previous user cleanup\n                    if (userCleanup) {\n                        if (debug) console.log(\"[useGSAPResponsive] Running user cleanup\");\n                        userCleanup();\n                    }\n\n                    // Run user's setup and capture return value, passing contextSafe\n                    const result = userSetup(safeRoot, safeContextSafe);\n\n                    // Extract timeline and cleanup from result (if result is not void)\n                    if (result) {\n                        currentTimelineRef.tl = result.timeline || null;\n                        userCleanup = result.cleanup;\n                    } else {\n                        currentTimelineRef.tl = null;\n                        userCleanup = undefined;\n                    }\n\n                    if (debug) {\n                        console.log(\"[useGSAPResponsive] Timeline captured:\", currentTimelineRef.tl);\n                        if (handlers) {\n                            console.log(\"[useGSAPResponsive] isLoadComplete:\", handlers.isLoadComplete());\n                        }\n                    }\n\n                    // If playAfterLoad is enabled, ensure timeline starts paused\n                    if (playAfterLoad && currentTimelineRef.tl) {\n                        // handlers exists because we threw earlier if playAfterLoad was boolean true\n                        if (handlers!.isLoadingEnabled()) {\n                            // Loading is enabled, pause and wait for load complete\n                            if (!currentTimelineRef.tl.paused()) {\n                                if (debug) console.log(\"[useGSAPResponsive] Pausing timeline (playAfterLoad enabled)\");\n                                currentTimelineRef.tl.pause();\n                            }\n\n                            // If page is already loaded, play the timeline\n                            if (handlers!.isLoadComplete()) {\n                                if (debug) console.log(\"[useGSAPResponsive] Playing timeline (load already complete)\");\n                                currentTimelineRef.tl.play();\n                            }\n                        } else {\n                            // If loading animation is disabled, just play immediately\n                            if (debug) console.log(\"[useGSAPResponsive] Loading disabled, playing timeline immediately\");\n                            // Don't pause, let it play naturally\n                            currentTimelineRef.tl.play();\n                        }\n                    }\n                };\n            }\n\n            // Helper to setup load complete handler\n            const setupLoadCompleteHandler = () => {\n                if (!playAfterLoad || !handlers) return undefined;\n\n                const handleLoadingComplete = () => {\n                    if (debug) console.log(\"[useGSAPResponsive] Load complete event fired\");\n                    if (currentTimelineRef.tl) {\n                        if (debug) console.log(\"[useGSAPResponsive] Playing timeline on load complete\");\n                        currentTimelineRef.tl.play();\n                    }\n                };\n\n                handlers.onLoadComplete(handleLoadingComplete);\n\n                return () => {\n                    if (debug) console.log(\"[useGSAPResponsive] Cleaning up load complete listener\");\n                    handlers!.offLoadComplete(handleLoadingComplete);\n                };\n            };\n\n            // Setup mediaQueries or single setup\n            if (mediaQueries && mediaQueries.length > 0) {\n                if (debug) console.log(\"[useGSAPResponsive] Setting up media queries:\", mediaQueries.length);\n\n                mediaQueries.forEach(({query, setup: mqSetup}) => {\n                    mm.add(query, () => {\n                        const wrappedSetup = wrapSetup(mqSetup);\n                        wrappedSetup();\n                        return setupLoadCompleteHandler();\n                    });\n                });\n            } else if (singleSetup) {\n                if (debug) console.log(\"[useGSAPResponsive] Setting up with default media query\");\n\n                mm.add(\"(min-width: 0px)\", () => {\n                    const wrappedSetup = wrapSetup(singleSetup);\n                    wrappedSetup();\n                    return setupLoadCompleteHandler();\n                });\n            }\n\n            // Setup ResizeObserver\n            let ro: ResizeObserver | null = null;\n\n            if (observeResize) {\n                if (debug) console.log(\"[useGSAPResponsive] Setting up ResizeObserver for:\", observeResize);\n\n                const elements = safeRoot.querySelectorAll(observeResize);\n\n                if (elements.length > 0) {\n                    // Get the wrapped setup from the appropriate source\n                    const setupToRun = mediaQueries && mediaQueries.length > 0\n                        ? wrapSetup(mediaQueries[0].setup) // Use first media query's setup\n                        : singleSetup\n                            ? wrapSetup(singleSetup)\n                            : null;\n\n                    if (setupToRun) {\n                        let resizeTimeout: ReturnType<typeof setTimeout> | null = null;\n\n                        ro = new ResizeObserver(() => {\n                            // Clear previous timeout to debounce\n                            if (resizeTimeout) {\n                                clearTimeout(resizeTimeout);\n                            }\n\n                            // Wait for resize to settle before re-running setup\n                            resizeTimeout = setTimeout(() => {\n                                if (debug) console.log(\"[useGSAPResponsive] Resize detected, re-running setup\");\n                                setupToRun();\n                            }, 150); // 150ms debounce\n                        });\n\n                        elements.forEach((el) => ro!.observe(el));\n\n                        if (debug) console.log(\"[useGSAPResponsive] Observing\", elements.length, \"elements\");\n                    }\n                } else {\n                    if (debug) console.log(\"[useGSAPResponsive] No elements found for selector:\", observeResize);\n                }\n            }\n\n            // Cleanup\n            return () => {\n                if (debug) console.log(\"[useGSAPResponsive] Cleaning up\");\n\n                mm.revert();\n\n                if (ro) {\n                    ro.disconnect();\n                }\n\n                if (userCleanup) {\n                    userCleanup();\n                }\n            };\n        },\n        {scope, dependencies, revertOnUpdate}\n    );\n}\n\nfunction getRoot(scope: useGSAPConfig['scope']) {\n    // resolve `scope` (which may be ReactRef | Element | string) to an HTMLElement | null\n    let root: HTMLElement | null = null;\n\n    if (!scope) {\n        console.warn(\"[useGSAPResponsive] No scope provided\");\n        return;\n    }\n\n    if (typeof scope === \"object\" && \"current\" in scope) {\n        // React ref\n        root = (scope as any).current as HTMLElement | null;\n    } else if (typeof scope === \"string\") {\n        // selector string -> resolve in DOM (guard for SSR)\n        root = typeof document !== \"undefined\" ? (document.querySelector(scope) as HTMLElement | null) : null;\n    } else if (scope instanceof Element) {\n        // direct Element\n        root = scope as HTMLElement;\n    }\n\n    return root;\n}"],"mappings":";;;;;;;AACA,OAAQ,WAAAA,MAA4C,cACpD,OAAOC,MAAU,OAEjBA,EAAK,eAAeD,CAAO,EAsBpB,SAASE,EACZC,EACAC,EACa,CACb,GAAM,CACF,MAAAC,EACA,aAAAC,EACA,eAAAC,EACA,cAAAC,EACA,cAAAC,EAAgB,GAChB,MAAAC,EAAQ,EACZ,EAAIN,GAAU,CAAC,EACf,OAAOJ,EACH,CAACW,EAASC,IAAgB,CACtB,IAAMC,EAAOC,EAAQT,CAAK,EAE1B,GAAI,CAACQ,EAAM,CACP,QAAQ,KAAK,2CAA2C,EACxD,MACJ,CAKA,GAHIH,GAAO,QAAQ,IAAI,kCAAkC,EAGrD,CAACE,EAAa,CACd,QAAQ,MAAM,yDAAyD,EACvE,MACJ,CAGA,IAAMG,EAAmCH,EAGnCI,EAAmB,MAAM,QAAQb,CAAc,EAC/Cc,EAAeD,EAAmBb,EAAiB,KACnDe,EAAeF,EAAoC,KAAjBb,EAGpCgB,EACJ,GAAIV,EACA,GAAI,OAAOA,GAAkB,SACzBU,EAAWV,MAGX,OAAM,IAAI,MACN,8JAEJ,EAIR,IAAMW,EAAKnB,EAAK,WAAW,EAGrBoB,EAAWR,EAGbS,EAAwD,CAAC,GAAI,IAAI,EACjEC,EAGJ,SAASC,EAAUC,EAAkB,CACjC,MAAO,IAAM,CACLf,GAAO,QAAQ,IAAI,mCAAmC,EAGtDa,IACIb,GAAO,QAAQ,IAAI,0CAA0C,EACjEa,EAAY,GAIhB,IAAMG,EAASD,EAAUJ,EAAUN,CAAe,EAG9CW,GACAJ,EAAmB,GAAKI,EAAO,UAAY,KAC3CH,EAAcG,EAAO,UAErBJ,EAAmB,GAAK,KACxBC,EAAc,QAGdb,IACA,QAAQ,IAAI,yCAA0CY,EAAmB,EAAE,EACvEH,GACA,QAAQ,IAAI,sCAAuCA,EAAS,eAAe,CAAC,GAKhFV,GAAiBa,EAAmB,KAEhCH,EAAU,iBAAiB,GAEtBG,EAAmB,GAAG,OAAO,IAC1BZ,GAAO,QAAQ,IAAI,8DAA8D,EACrFY,EAAmB,GAAG,MAAM,GAI5BH,EAAU,eAAe,IACrBT,GAAO,QAAQ,IAAI,8DAA8D,EACrFY,EAAmB,GAAG,KAAK,KAI3BZ,GAAO,QAAQ,IAAI,oEAAoE,EAE3FY,EAAmB,GAAG,KAAK,GAGvC,CACJ,CAGA,IAAMK,EAA2B,IAAM,CACnC,GAAI,CAAClB,GAAiB,CAACU,EAAU,OAEjC,IAAMS,EAAwB,IAAM,CAC5BlB,GAAO,QAAQ,IAAI,+CAA+C,EAClEY,EAAmB,KACfZ,GAAO,QAAQ,IAAI,uDAAuD,EAC9EY,EAAmB,GAAG,KAAK,EAEnC,EAEA,OAAAH,EAAS,eAAeS,CAAqB,EAEtC,IAAM,CACLlB,GAAO,QAAQ,IAAI,wDAAwD,EAC/ES,EAAU,gBAAgBS,CAAqB,CACnD,CACJ,EAGIX,GAAgBA,EAAa,OAAS,GAClCP,GAAO,QAAQ,IAAI,gDAAiDO,EAAa,MAAM,EAE3FA,EAAa,QAAQ,CAAC,CAAC,MAAAY,EAAO,MAAOC,CAAO,IAAM,CAC9CV,EAAG,IAAIS,EAAO,KACWL,EAAUM,CAAO,EACzB,EACNH,EAAyB,EACnC,CACL,CAAC,GACMT,IACHR,GAAO,QAAQ,IAAI,yDAAyD,EAEhFU,EAAG,IAAI,mBAAoB,KACFI,EAAUN,CAAW,EAC7B,EACNS,EAAyB,EACnC,GAIL,IAAII,EAA4B,KAEhC,GAAIvB,EAAe,CACXE,GAAO,QAAQ,IAAI,qDAAsDF,CAAa,EAE1F,IAAMwB,EAAWX,EAAS,iBAAiBb,CAAa,EAExD,GAAIwB,EAAS,OAAS,EAAG,CAErB,IAAMC,EAAahB,GAAgBA,EAAa,OAAS,EACnDO,EAAUP,EAAa,CAAC,EAAE,KAAK,EAC/BC,EACIM,EAAUN,CAAW,EACrB,KAEV,GAAIe,EAAY,CACZ,IAAIC,EAAsD,KAE1DH,EAAK,IAAI,eAAe,IAAM,CAEtBG,GACA,aAAaA,CAAa,EAI9BA,EAAgB,WAAW,IAAM,CACzBxB,GAAO,QAAQ,IAAI,uDAAuD,EAC9EuB,EAAW,CACf,EAAG,GAAG,CACV,CAAC,EAEDD,EAAS,QAASG,GAAOJ,EAAI,QAAQI,CAAE,CAAC,EAEpCzB,GAAO,QAAQ,IAAI,gCAAiCsB,EAAS,OAAQ,UAAU,CACvF,CACJ,MACQtB,GAAO,QAAQ,IAAI,sDAAuDF,CAAa,CAEnG,CAGA,MAAO,IAAM,CACLE,GAAO,QAAQ,IAAI,iCAAiC,EAExDU,EAAG,OAAO,EAENW,GACAA,EAAG,WAAW,EAGdR,GACAA,EAAY,CAEpB,CACJ,EACA,CAAC,MAAAlB,EAAO,aAAAC,EAAc,eAAAC,CAAc,CACxC,CACJ,CAEA,SAASO,EAAQT,EAA+B,CAE5C,IAAIQ,EAA2B,KAE/B,GAAI,CAACR,EAAO,CACR,QAAQ,KAAK,uCAAuC,EACpD,MACJ,CAEA,OAAI,OAAOA,GAAU,UAAY,YAAaA,EAE1CQ,EAAQR,EAAc,QACf,OAAOA,GAAU,SAExBQ,EAAO,OAAO,SAAa,IAAe,SAAS,cAAcR,CAAK,EAA2B,KAC1FA,aAAiB,UAExBQ,EAAOR,GAGJQ,CACX","names":["useGSAP","gsap","useGSAPResponsive","setupOrQueries","config","scope","dependencies","revertOnUpdate","observeResize","playAfterLoad","debug","context","contextSafe","root","getRoot","safeContextSafe","isMediaQueryMode","mediaQueries","singleSetup","handlers","mm","safeRoot","currentTimelineRef","userCleanup","wrapSetup","userSetup","result","setupLoadCompleteHandler","handleLoadingComplete","query","mqSetup","ro","elements","setupToRun","resizeTimeout","el"]}